name: Merge Macros

on:
  workflow_dispatch:
    inputs:
      versions:
        description: 'How many versions per group'
        default: '16'
      intra_file_max:
        description: 'Within-file max pause time (e.g. "1.30" or "1m30s")'
        default: '1m32s'
      max_intra_pauses:
        description: 'Max pauses inside each file'
        default: '3'
      after_file_max:
        description: 'After-file (between-files) max pause time (e.g. "4m53s")'
        default: '2m37s'
      exclude_count:
        description: 'Max files to randomly exclude per version (0â€“N-1)'
        default: '5'
      max_after_pauses:
        description: 'Max pauses between files (ignored; for compatibility)'
        default: '1'

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Run Merge Script
        run: |
          python3 merge_macros.py \
            --input-dir "originals" \
            --output-dir "output" \
            --versions "${{ github.event.inputs.versions }}" \
            --intra-file-max "${{ github.event.inputs.intra_file_max }}" \
            --exclude-count "${{ github.event.inputs.exclude_count }}" \
            --inter-file-max "${{ github.event.inputs.after_file_max }}" \
            --inter-file-count "${{ github.event.inputs.max_after_pauses }}"

      - name: Zip merged outputs
        run: zip -r merged_bundle.zip output/

      - name: Upload merged artifact
        uses: actions/upload-artifact@v4
        with:
          name: merged_bundle
          path: merged_bundle.zip
