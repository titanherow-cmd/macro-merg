name: Merge macros (simple UI — exact fields)

on:
  workflow_dispatch:
    inputs:
      versions:
        description: 'How many versions per group'
        required: true
        default: '5'
      within_max_time:
        description: "Within-file max pause time (e.g. '1.30' or '1m30s')"
        required: true
        default: '2m47s'
      within_max_pauses:
        description: 'Max pauses inside each file (integer)'
        required: true
        default: '4'
      between_max_time:
        description: "After-file (between-files) max pause time (e.g. '4m53s')"
        required: true
        default: '4m53s'
      between_max_pauses:
        description: 'Max pauses between files (ignored; for compatibility)'
        required: true
        default: '1'
      exclude_count:
        description: 'Max files to randomly exclude per version (0–N-1)'
        required: true
        default: '1'

jobs:
  merge:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Run merger with simplified UI inputs
        run: |
          set -euo pipefail

          VERSIONS="${{ github.event.inputs.versions }}"
          WITHIN_MAX_TIME="${{ github.event.inputs.within_max_time }}"
          WITHIN_MAX_PAUSES="${{ github.event.inputs.within_max_pauses }}"
          BETWEEN_MAX_TIME="${{ github.event.inputs.between_max_time }}"
          BETWEEN_MAX_PAUSES="${{ github.event.inputs.between_max_pauses }}"
          EXCLUDE_COUNT="${{ github.event.inputs.exclude_count }}"

          ARGS="--versions ${VERSIONS} --within-max-time \"${WITHIN_MAX_TIME}\" --within-max-pauses ${WITHIN_MAX_PAUSES} --between-max-time \"${BETWEEN_MAX_TIME}\" --between-max-pauses ${BETWEEN_MAX_PAUSES} --exclude-count ${EXCLUDE_COUNT}"

          echo "Running: python merge_macros.py ${ARGS}"
          eval python merge_macros.py ${ARGS}

      - name: Upload merged ZIP
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: merged-zip
          path: output/merged_bundle.zip
